<:wrap shopbase.tmpl title=>"Shop Checkout" :>
<table class="items">
  <caption>Order items</caption>
  <thead>
    <tr>
      <th class="item">Item</th>
      <th class="quantity">Qty</th>
      <th class="price">Price</th>
      <th class="extended">Extended</th>
    </tr>
  </thead>
  <tbody><:iterator begin items:>
    <tr>
      <td class="item">
        <a href="<:item link:>" class="title"><:item title:></a><:ifOptions:>
        <span><:options:></span><:eif:><:if And [item description] [cfg shop product_description 1]:>
        <div class="description"><:item description:></div><:eif And:>
      </td>
      <td class="quantity"><:item units:> &times;</td>
      <td class="price"><:cfg shop currency "$":><:number money [item price]:></td>
      <td class="extended"><:cfg shop currency "$":><:number money [arithmetic [item units] * [item price]]:></td>
    </tr><:iterator end items:>
  </tbody>
</table>
<div class="totals">
  <:switch:>
  <:case Shipping_cost:>
  <p class="freight"><span>(<:shipping_method:><:if Delivery_in:>, delivery in <:delivery_in:> days<:eif Delivery_in:>)</span> <label>Freight:</label> <:cfg shop currency "$":><:number money [shipping_cost]:></p>
  <:case Match [order shipping_name] ^contact$:>
  <p class="freight"><span>(<:shipping_method:>)</span> <label>Freight:</label> TBA</p>
  <:case default:>
  <:endswitch:>
  <p class="total"><abbr><:cfg shop currency_code "AUD":></abbr> <label>Total:</label> <:cfg shop currency "$":><:number money [total]:></p>
</div><:if Cfg "site users" nopassword:><:or Cfg:><:if User:>
<p class="alert">
  This purchase will be added to your order history. You can track the status of your purchases and maintain your account details in your <a href="<:target user userpage |h:>">account manager</a>.
</p><:or User:>
<p class="alert">To track the status of your purchase you must <:if Or [cfg "site users" user_register]:>either <a href="<:dyntarget user show_register r [dyntarget shop order] :>">Signup</a> or <:eif Or:><a href="<:dyntarget user show_logon r [dyntarget shop order] :>">Logon</a> before you continue with this purchase.
</p><:eif User:><:eif Cfg:>
<form action="<:target shop |h:>" method="post" name="checkoutpay">
<:- ifOrder id:>
<input type="hidden" name="order_id" value="<:order id:>" />
<:- eif:>
  <h2>Payment Details</h2>
  <fieldset>
    <:- if Payments CC:>
    <dl class="paymentType0">
      <dt>
        <:- if MultPaymentTypes:>
        <input type="radio" name="paymentType" id="paymentType0" value="0" <:checkedPayment CC:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="0" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType0">Credit Card</label>
      </dt>
      <dd>
        <table>
          <caption>Account Details</caption>
          <tr>
            <th><label for="ccName"><:cfg shop display_ccName "Name on Card":>:<:error_img ccName:></label></th>
            <td><input type="text" name="ccName" id="ccName" size="40" value="<:old ccName:>" class="<:ifError_img ccName:>error<:eif:>" /></td>
          </tr>
          <tr>
            <th><label for="cardNumber"><:cfg shop display_cardNumber "Card Number":>:<:error_img cardNumber:></label></th>
            <td><input type="text" name="cardNumber" id="cardNumber" size="16" maxlength="16" value="<:old cardNumber:>" class="<:ifError_img cardNumber:>error<:eif:>" />
              <label for="cardVerify"><:cfg shop display_cardVerify "CVV":>:<:error_img cardVerify:></label> <input type="text" name="cardVerify" id="cardVerify" size="4" maxlength="4" value="<:old cardVerify:>" class="<:ifError_img cardVerify:>error<:eif:>" /> <:help cvv2 CVV:>
            </td>
          </tr>
          <tr>
            <th><label for="cardExpiry"><:cfg shop display_cardExpiry "Expiry Date":>:<:error_img cardExpiry:></label></th>
            <td><input type="text" name="cardExpiry" id="cardExpiry" size="5" maxlength="5" value="<:old cardExpiry:>" class="<:ifError_img cardExpiry:>error<:eif:>" /> <span class="small">(MM/YY)</span></td>
          </tr>
          <tr>
            <th><label for="ccType"><:cfg shop display_ccType "Card Type":>:<:error_img ccType:></label></th>
            <td>
              <select name="ccType" id="ccType" class="<:ifError_img ccType:>error<:eif:>">
                <option value="" selected="selected">Select card type</option>
                <:if Cfgsection "payment ccType":>
                <:iterator begin dyncfgsection "payment ccType" sort=key:>
                <option value="<:dyncfgentry value:>"<:if Eq [old ccType] [dyncfgentry value]:> selected="selected"<:eif Eq:>><:dyncfgentry value:></option>
                <:iterator end dyncfgsection:>
                <:or Cfgsection:>
                <option value="Visa"<:ifEq [cgi ccType] "Visa":> selected="selected"<:eif:>>Visa</option>
                <option value="Mastercard"<:ifEq [cgi ccType] "Mastercard":> selected="selected"<:eif:>>Mastercard</option>
                <:eif Cfgsection:>
              </select>
            </td>
          </tr>
        </table>
      </dd>
    </dl>
    <:- eif Payments:>
    <:- if Payments PayPal:>
    <dl class="paymentType4">
      <dt class="paypal">
        <:- if MultPaymentTypes:>
        <input type="radio" name="paymentType" id="paymentType4" value="4" <:checkedPayment PayPal:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="4" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType4">PayPal</label>
      </dt>
      <dd>
        <p>You will be redirected to the PayPal checkout page, there you can pay using your PayPal account balance, credit card or your linked bank account.</p>
        <p class="small">Your order will be processed when payment receipt is confirmed.</p>
      </dd>
    </dl>
    <:- eif Payments:>
    <:- if Payments DirectDeposit:>
    <dl class="paymentType10">
      <dt>
        <:- if MultPaymentTypes:>
        <input type="radio" name="paymentType" id="paymentType10" value="10" <:checkedPayment DirectDeposit:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="10" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType10">EFT</label>
      </dt>
      <dd>
        <p>Please transfer the funds to:</p>
        <table>
          <caption>Account Details</caption>
          <tr>
            <th>Name:</th>
            <td><:cfg shop accountname |h:></td>
          </tr>
          <tr>
            <th>BSB:</th>
            <td><:cfg shop bsb |h:></td>
          </tr><:ifCfg shop swiftcode:>
          <tr>
            <th>SWIFT Code:</th>
            <td><:cfg shop swiftcode |h:></td>
          </tr><:eif:>
          <tr>
            <th>Account:</th>
            <td><:cfg shop accountno |h:></td>
          </tr>
          <tr>
            <th>Reference:</th>
            <td>&lt;Your order number&gt;</td>
          </tr>
        </table>
        <p class="small">Your order will be processed when payment transfer is confirmed.</p>
      </dd>
    </dl>
    <:- eif Payments:>
    <:- if Payments Cheque:>
    <dl class="paymentType1">
      <dt>
        <:- if MultPaymentTypes:>
        <input type="radio" name="paymentType" id="paymentType1" value="1" <:checkedPayment Cheque:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="1" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType1">Cheque</label>
      </dt>
      <dd>
        <p>Please send a cheque to:</p>
        <address>
          <b><:cfg shop address1 |h:></b><br />
          <:cfg shop address2 |h:><br />
          <:cfg shop address3 |h:><br />
          <:cfg shop address4 |h:>
        </address>
        <p class="small">Your order will be processed when cheque has cleared.</p>
      </dd>
    </dl>
    <:- eif Payments:>
    <:- if Payments CallMe:>
    <dl class="paymentType2">
      <dt>
        <:- if MultPaymentTypes:>
        <input type="radio" name="paymentType" id="paymentType2" value="<:paymentTypeId CallMe:>" <:checkedPayment CallMe:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="<:paymentTypeId CallMe:>" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType2">Contact</label>
      </dt>
      <dd>
        <p>We will contact you to make arrangements for payment.</p>
        <p class="small">Your order will be processed when payment is received.</p>
      </dd>
    </dl>
    <:- eif Payments:>
    <:- if Payments Invoice:>
    <dl class="paymentType11">
      <dt>
        <:- if MultPaymentTypes:>
        <input type=radio name="paymentType" id="paymentType11" value="11" <:checkedPayment Invoice:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="11" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType11">Invoice</label>
      </dt>
      <dd>
        <p>We will send you an invoice for payment.</p>
        <p class="small">Your order will be processed when payment is received.</p>
      </dd>
    </dl>
    <:- eif Payments:>
    <:- if Payments Account:>
    <dl class="paymentType12">
      <dt>
        <:- if MultPaymentTypes:>
        <input type="radio" name="paymentType" id="paymentType12" value="12" <:checkedPayment Account:> />
        <:- or MultPaymentTypes:>
        <input type="hidden" name="paymentType" value="12" />
        <:- eif MultPaymentTypes:>
        <label for="paymentType12">Account</label>
      </dt>
      <dd>
        <p>We will add this order to your account.</p>
      </dd>
    </dl>
    <:- eif Payments:>
    <:include include/custom/payment_type_checkout.tmpl optional:><:include include/payment_type_checkout.tmpl optional:>
  </fieldset>
  <:- if MultPaymentTypes:>
  <p>Please select your preferred payment method</p>
  <:- eif MultPaymentTypes:>
  <p class="buttons">
    <input type="submit" value="Purchase now" name="payment" accesskey="p" title="AccessKey = p" />
    <input type="submit" value="Go back" name="checkout" accesskey="b" title="AccessKey = b" />
  </p>
</form>
<:- if MultPaymentTypes:>
<script type="text/javascript">
(function() {
    if (document.addEventListener) {
        var radios = document.querySelectorAll("dl input[type=radio]");

        function hideallbut(radio) {
            for (var i = 0; i < radios.length; ++i) {
                var aradio = radios[i];
                // find the dl
                // this would be: dl = aradio.up("DL") in prototype
                var dl = aradio;
                while (dl.tagName != "DL") {
                    dl = dl.parentNode;
                }
                var dd = dl.querySelector("dd");
                if (aradio === radio) {
                    dd.style.display = "";
                } else {
                    dd.style.display = "none";
                }
            }
        }
        for (var i = 0; i < radios.length; ++i) {
            var radio = radios[i];
            if (radio.checked) {
                hideallbut(radio);
            }
            radio.addEventListener("click", function(ev) {
                hideallbut(this);
            });
        }
    }
})();
</script>
<:- eif MultPaymentTypes:>